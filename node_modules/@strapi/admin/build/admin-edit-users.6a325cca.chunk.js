"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[4263],{28976:(J,_,e)=>{e.r(_),e.d(_,{default:()=>Ze});var t=e(32735),s=e(10938),m=e(5141),O=e(92891),R=e(79613),p=e(93587),I=e.n(p),f=e(5636),T=e(60216),P=e.n(T),C=e(88423),D=e.n(C),k=e(33795),N=e.n(k),H=e(9086),V=e.n(H),X=e(84968),w=e(83281),U=e(9808),S=e(44526),y=e(78330),M=e(11856),L=e(58434),Z=e(95602),j=e(16540),$=e(90662),W=e(98599),l=e.n(W),r=e(88677),o=e.n(r),q=e(81430),te=e(81999),F=(n,i,a)=>new Promise((d,u)=>{var h=c=>{try{K(a.next(c))}catch(g){u(g)}},v=c=>{try{K(a.throw(c))}catch(g){u(g)}},K=c=>c.done?d(c.value):Promise.resolve(c.value).then(h,v);K((a=a.apply(n,i)).next())});const Pe=n=>F(void 0,null,function*(){const{data:i}=yield te.be.get(`/admin/users/${n}`);return i.data}),ye=(n,i)=>F(void 0,null,function*(){const{data:a}=yield te.be.put(`/admin/users/${n}`,i);return a.data}),Me=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"email",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12}},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]];var he=e(99063),Oe=e(58535),_e=e(98399),De=void 0;function Le(n,i){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Ae(n))||i&&n&&typeof n.length=="number"){a&&(n=a);var d=0,u=function(){};return{s:u,n:function(){return d>=n.length?{done:!0}:{done:!1,value:n[d++]}},e:function(g){throw g},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,v=!1,K;return{s:function(){a=a.call(n)},n:function(){var g=a.next();return h=g.done,g},e:function(g){v=!0,K=g},f:function(){try{!h&&a.return!=null&&a.return()}finally{if(v)throw K}}}}function Ae(n,i){if(!!n){if(typeof n=="string")return se(n,i);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return se(n,i)}}function se(n,i){(i==null||i>n.length)&&(i=n.length);for(var a=0,d=new Array(i);a<i;a++)d[a]=n[a];return d}var Ie=Object.defineProperty,Te=Object.defineProperties,Ce=Object.getOwnPropertyDescriptors,oe=Object.getOwnPropertySymbols,Ue=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable,le=function(i,a,d){return a in i?Ie(i,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):i[a]=d},ie=function(i,a){for(var d in a||(a={}))Ue.call(a,d)&&le(i,d,a[d]);if(oe){var u=Le(oe(a)),h;try{for(u.s();!(h=u.n()).done;){var d=h.value;Be.call(a,d)&&le(i,d,a[d])}}catch(v){u.e(v)}finally{u.f()}}return i},Re=function(i,a){return Te(i,Ce(a))},We=function(i,a,d){return new Promise(function(u,h){var v=function(b){try{c(d.next(b))}catch(Y){h(Y)}},K=function(b){try{c(d.throw(b))}catch(Y){h(Y)}},c=function(b){return b.done?u(b.value):Promise.resolve(b.value).then(v,K)};c((d=d.apply(i,a)).next())})},Ke=function(){return window&&window.strapi&&window.strapi.isEE?e(80515).Z:e(83396).Z}(),de=["email","firstname","lastname","username","isActive","roles"],ue=function(i){var a=i.canUpdate,d=(0,f.useIntl)(),u=d.formatMessage,h=(0,m.useRouteMatch)("/settings/users/:id"),v=h.params.id,K=(0,m.useHistory)(),c=K.push,g=(0,s.useAppInfos)(),b=g.setUserDisplayName,Y=(0,s.useNotification)(),ce=(0,s.useOverlayBlocker)(),je=ce.lockApp,be=ce.unlockApp;(0,s.useFocusWhenNavigate)();var me=(0,X.useQuery)(["user",v],function(){return Pe(v)},{retry:!1,keepPreviousData:!1,staleTime:1e3*20,onError:function(E){var z=E.response.status;z===403&&(Y({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),c("/")),_e.log(E.response.status)}}),ze=me.status,x=me.data,Ne=function(E,z){return We(De,null,I().mark(function Q(){var ee,re,G,ne,Ee;return I().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return je(),A.prev=1,A.next=4,ye(v,V()(E,"confirmPassword"));case 4:ee=A.sent,Y({type:"success",message:u({id:"notification.success.saved",defaultMessage:"Saved"})}),re=s.auth.getUserInfo(),v.toString()===re.id.toString()&&(s.auth.setUserInfo(ee),G=N()(E,"username")||(0,q.Pp)(E.firstname,E.lastname),b(G)),z.setValues(D()(E,de)),A.next=17;break;case 11:A.prev=11,A.t0=A.catch(1),ne=(0,q.Iz)(A.t0.response.data),Ee=Object.keys(ne).reduce(function(ve,ge){return ve[ge]=ne[ge].id,ve},{}),z.setErrors(Ee),Y({type:"warning",message:N()(A.t0,"response.data.message","notification.error")});case 17:be();case 18:case"end":return A.stop()}},Q,null,[[1,11]])}))},pe=ze!=="success",we=pe?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},ae=Object.keys(D()(x,de)).reduce(function(B,E){return E==="roles"?(B[E]=((x==null?void 0:x.roles)||[]).map(function(z){var Q=z.id;return Q}),B):(B[E]=x==null?void 0:x[E],B)},{}),$e=ae.username||(0,q.Pp)(ae.firstname,ae.lastname),fe=u(we,{name:$e});return pe?t.createElement(j.Main,{"aria-busy":"true"},t.createElement(s.SettingsPageTitle,{name:"Users"}),t.createElement(M.HeaderLayout,{primaryAction:t.createElement(S.Button,{disabled:!0,startIcon:t.createElement(o(),null),type:"button",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:fe,navigationAction:t.createElement(L.Link,{startIcon:t.createElement(l(),null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},u({id:"global.back",defaultMessage:"Back"}))}),t.createElement(M.ContentLayout,null,t.createElement(s.LoadingIndicatorPage,null))):t.createElement(j.Main,null,t.createElement(s.SettingsPageTitle,{name:"Users"}),t.createElement(w.Formik,{onSubmit:Ne,initialValues:ae,validateOnChange:!1,validationSchema:he.YM},function(B){var E=B.errors,z=B.values,Q=B.handleChange,ee=B.isSubmitting;return t.createElement(s.Form,null,t.createElement(M.HeaderLayout,{primaryAction:t.createElement(S.Button,{disabled:ee||!a,startIcon:t.createElement(o(),null),loading:ee,type:"submit",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:fe,navigationAction:t.createElement(L.Link,{startIcon:t.createElement(l(),null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},u({id:"global.back",defaultMessage:"Back"}))}),t.createElement(M.ContentLayout,null,(x==null?void 0:x.registrationToken)&&t.createElement(U.Box,{paddingBottom:6},t.createElement(Ke,{registrationToken:x.registrationToken})),t.createElement($.Stack,{spacing:7},t.createElement(U.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement($.Stack,{spacing:4},t.createElement(Z.Typography,{variant:"delta",as:"h2"},u({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(y.Grid,{gap:5},Me.map(function(re){return re.map(function(G){return t.createElement(y.GridItem,ie({key:G.name},G.size),t.createElement(s.GenericInput,Re(ie({},G),{disabled:!a,error:E[G.name],onChange:Q,value:z[G.name]||""})))})})))),t.createElement(U.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement($.Stack,{spacing:4},t.createElement(Z.Typography,{variant:"delta",as:"h2"},u({id:"global.roles",defaultMessage:"User's role"})),t.createElement(y.Grid,{gap:5},t.createElement(y.GridItem,{col:6,xs:12},t.createElement(Oe.Z,{disabled:!a,error:E.roles,onChange:Q,value:z.roles}))))))))}))};ue.propTypes={canUpdate:P().bool.isRequired};const Se=ue,Ze=()=>{const n=(0,s.useNotification)(),i=(0,t.useMemo)(()=>({read:R.Z.settings.users.read,update:R.Z.settings.users.update}),[]),{isLoading:a,allowedActions:{canRead:d,canUpdate:u}}=(0,s.useRBAC)(i),{state:h}=(0,m.useLocation)(),v=(0,O.get)(h,"from","/");return(0,t.useEffect)(()=>{a||!d&&!u&&n({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[a,d,u,n]),a?t.createElement(s.LoadingIndicatorPage,null):!d&&!u?t.createElement(m.Redirect,{to:v}):t.createElement(Se,{canUpdate:u})}},98924:(J,_,e)=>{e.d(_,{Z:()=>V});var t=e(32735),s=e(60216),m=e.n(s),O=e(20763),R=e.n(O),p=e(10938),I=e.n(p),f=e(68192),T=e.n(f),P=e(59087),C=e.n(P),D=e(5636),k=e.n(D);const N=()=>t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg"},t.createElement("text",{transform:"translate(-23 -9)",fill:"#4B515A",fillRule:"evenodd",fontSize:"32",fontFamily:"AppleColorEmoji, Apple Color Emoji"},t.createElement("tspan",{x:"23",y:"36"},"\u2709\uFE0F"))),H=({children:X,target:w})=>{const U=(0,p.useNotification)(),{formatMessage:S}=(0,D.useIntl)(),y=()=>{U({type:"info",message:{id:"notification.link-copied"}})},M=S({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"});return t.createElement(p.ContentBox,{endAction:t.createElement(P.CopyToClipboard,{onCopy:y,text:w},t.createElement(O.IconButton,{label:M,noBorder:!0,icon:t.createElement(T(),null)})),title:w,titleEllipsis:!0,subtitle:X,icon:t.createElement(N,null),iconBackground:"neutral100"})};H.propTypes={children:m().oneOfType([m().element,m().string]).isRequired,target:m().string.isRequired};const V=H},83396:(J,_,e)=>{e.d(_,{Z:()=>T});var t=e(32735),s=e(5636),m=e.n(s),O=e(60216),R=e.n(O),p=e(6630),I=e(98924);const f=({registrationToken:P})=>{const{formatMessage:C}=(0,s.useIntl)(),D=`${window.location.origin}${p.Z}auth/register?registrationToken=${P}`;return t.createElement(I.Z,{target:D},C({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};f.defaultProps={registrationToken:""},f.propTypes={registrationToken:R().string};const T=f},58535:(J,_,e)=>{e.d(_,{Z:()=>S});var t=e(32735),s=e(60216),m=e.n(s),O=e(5636),R=e.n(O),p=e(25716),I=e.n(p),f=e(84968),T=e.n(f),P=e(19615),C=e(103),D=e.n(C),k=e(81999),N=(y,M,L)=>new Promise((Z,j)=>{var $=r=>{try{l(L.next(r))}catch(o){j(o)}},W=r=>{try{l(L.throw(r))}catch(o){j(o)}},l=r=>r.done?Z(r.value):Promise.resolve(r.value).then($,W);l((L=L.apply(y,M)).next())});const H=P.keyframes`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,V=P.default.div`
  animation: ${H} 2s infinite linear;
`,X=()=>t.createElement(V,null,t.createElement(D(),null)),w=()=>N(void 0,null,function*(){const{data:y}=yield k.be.get("/admin/roles");return y.data}),U=({disabled:y,error:M,onChange:L,value:Z})=>{const{status:j,data:$}=(0,f.useQuery)(["roles"],w,{staleTime:5e4}),{formatMessage:W}=(0,O.useIntl)(),l=M?W({id:M,defaultMessage:M}):"",r=W({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),o=W({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),q=W({id:"app.components.Select.placeholder",defaultMessage:"Select"}),te=j==="loading"?t.createElement(X,null):void 0;return t.createElement(p.Select,{id:"roles",disabled:y,error:l,hint:o,label:r,name:"roles",onChange:F=>{L({target:{name:"roles",value:F}})},placeholder:q,multi:!0,startIcon:te,value:Z,withTags:!0,required:!0},($||[]).map(F=>t.createElement(p.Option,{key:F.id,value:F.id},F.name)))};U.defaultProps={disabled:!1,error:void 0},U.propTypes={disabled:m().bool,error:m().string,onChange:m().func.isRequired,value:m().array.isRequired};const S=U},99063:(J,_,e)=>{e.d(_,{YM:()=>W,Rw:()=>N});var t=e(5173),s=e(10938),m=Object.defineProperty,O=Object.defineProperties,R=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,I=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,T=(l,r,o)=>r in l?m(l,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[r]=o,P=(l,r)=>{for(var o in r||(r={}))I.call(r,o)&&T(l,o,r[o]);if(p)for(var o of p(r))f.call(r,o)&&T(l,o,r[o]);return l},C=(l,r)=>O(l,R(r));const D={firstname:t.nK().required(s.translatedErrors.required),lastname:t.nK(),email:t.Z_().email(s.translatedErrors.email).lowercase().required(s.translatedErrors.required),username:t.Z_().nullable(),password:t.Z_().min(8,s.translatedErrors.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.Z_().min(8,s.translatedErrors.minLength).oneOf([t.iH("password"),null],"components.Input.error.password.noMatch").when("password",(l,r)=>l?r.required(s.translatedErrors.required):r)},N=C(P({},D),{currentPassword:t.Z_().when(["password","confirmPassword"],(l,r,o)=>l||r?o.required(s.translatedErrors.required):o),preferedLanguage:t.Z_().nullable()}),V={roles:t.IX().min(1,s.translatedErrors.required).required(s.translatedErrors.required)};var X=Object.defineProperty,w=Object.defineProperties,U=Object.getOwnPropertyDescriptors,S=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,L=(l,r,o)=>r in l?X(l,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[r]=o,Z=(l,r)=>{for(var o in r||(r={}))y.call(r,o)&&L(l,o,r[o]);if(S)for(var o of S(r))M.call(r,o)&&L(l,o,r[o]);return l},j=(l,r)=>w(l,U(r));const W=t.Ry().shape(Z(j(Z({},D),{isActive:t.Xg()}),V))},80515:(J,_,e)=>{e.d(_,{Z:()=>T});var t=e(32735),s=e(5636),m=e.n(s),O=e(60216),R=e.n(O),p=e(6630),I=e(98924);const f=({registrationToken:P})=>{const{formatMessage:C}=(0,s.useIntl)();return P?t.createElement(I.Z,{target:`${window.location.origin}${p.Z}auth/register?registrationToken=${P}`},C({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):t.createElement(I.Z,{target:`${window.location.origin}${p.Z}auth/login`},C({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};f.defaultProps={registrationToken:""},f.propTypes={registrationToken:R().string};const T=f}}]);
